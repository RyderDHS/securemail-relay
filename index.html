<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SecureMail relay…</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font:14px system-ui,Segoe UI,Arial;margin:2rem;color:#222}
    .box{max-width:750px;margin:auto}
  </style>
</head>
<body>
<div class="box">
  <p>Opening secure message…</p>
  <form id="relayForm" method="post"></form>
  <noscript>This page requires JavaScript.</noscript>
</div>

<script>
function g(k){const u=new URL(location.href);return u.searchParams.get(k)}
function addHidden(f,n,v){const i=document.createElement('input');i.type='hidden';i.name=n;i.value=v;f.appendChild(i)}
(function(){
  try{
    const postUrl = decodeURIComponent(g('u')||'').trim();
    const raw     = decodeURIComponent(g('h')||'').trim();
    if(!postUrl || !raw) throw new Error('Missing u or h');

    const pairs = JSON.parse(raw);              // [{name:"...", value:"..."}, ...]
    const form  = document.getElementById('relayForm');
    form.action = postUrl;

    (pairs||[]).forEach(p=> addHidden(form, p.name, p.value));
    form.submit();
  }catch(e){
    document.querySelector('.box').innerHTML =
      '<p>Relay error: '+(e&&e.message?e.message:e)+'</p>'+
      '<p>URL received:</p><pre>'+location.href+'</pre>';
    console.error(e);
  }
})();
</script>
</body>
</html>
