<script>
(async () => {
  try {
    const q = new URLSearchParams(location.search);
    const post = q.get('u');       // https://securemail.commonspirit.org/formpostdir/safeformpost.aspx
    const raw  = q.get('raw');     // https://raw.githubusercontent.com/.../r/<id>.json

    const res = await fetch(raw, {cache:'no-store'});
    if (!res.ok) throw new Error('Cannot fetch payload: ' + res.status);
    const fields = await res.json(); // [{name, value}] o {name, b64}

    const f = document.createElement('form');
    f.method = 'POST';
    f.action = post;
    f.style.display = 'none';

    for (const it of fields) {
      const inp = document.createElement('input');
      inp.type  = 'hidden';
      inp.name  = it.name;
      inp.value = (it.value != null) ? it.value : (it.b64 ? atob(it.b64) : '');
      f.appendChild(inp);
    }

    document.body.appendChild(f);
    f.submit();
  } catch (e) {
    document.body.textContent = 'Relay error: ' + e.message;
  }
})();
</script>
